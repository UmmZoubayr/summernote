<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Summernote avec Firebase</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <!-- Summernote -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.18/summernote-lite.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.18/summernote-lite.min.js"></script>

    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        #editor { width: 100%; height: 300px; }
        input, button { margin-top: 10px; padding: 10px; font-size: 16px; display: block; width: 100%; }
    </style>
</head>
<body>

    <h2>Éditeur d'Articles</h2>

    <input type="text" id="title" placeholder="Titre de l'article">
    <input type="text" id="author" placeholder="Nom de l’auteur">
    
    <textarea id="editor">Chargement...</textarea>

    <button onclick="saveContent()">💾 Enregistrer</button>
    <button onclick="loadContent()">📂 Charger</button>

    <script>
        // 🔥 Configuration Firebase (REMPLACE avec TES infos Firebase)
        const firebaseConfig = {
            apiKey: "AIzaSyAwpH9bjZcnzKX9-lrikBuDO8-Zm-YUdXY",
            projectId: "muslima-corner-735f2",
            storageBucket: "muslima-corner-735f2.appspot.com",
            appId: "1:765114208709:android:c090ac011f7d2b75837bac"
        };

        // ✅ Initialisation Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // 🌍 Initialiser Summernote
        $(document).ready(function() {
            $('#editor').summernote({
                height: 300,
                placeholder: 'Écris ton article ici...',
                toolbar: [
                    ['style', ['bold', 'italic', 'underline', 'clear']],
                    ['font', ['fontsize', 'color']],
                    ['para', ['ul', 'ol', 'paragraph']],
                    ['insert', ['link', 'picture', 'video']],
                    ['view', ['fullscreen', 'codeview', 'help']]
                ]
            });

            // Charger l'article existant au démarrage
            loadContent();
        });

        // ✅ Enregistrer l'article avec le titre et l’auteur dans Firestore
        function saveContent() {
            var title = document.getElementById("title").value;
            var author = document.getElementById("author").value;
            var content = $('#editor').summernote('code');

            if (!title || !author) {
                alert("⚠️ Veuillez remplir tous les champs !");
                return;
            }

            db.collection("Articles").add({
                title: title,
                author: author,
                content: content,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            })
            .then(() => { 
                alert("✅ Article enregistré avec succès !");
                console.log("✅ Firestore: Enregistrement réussi !");
            })
            .catch((error) => { 
                console.error("❌ Erreur d'enregistrement:", error);
                alert("❌ Erreur: " + error.message);
            });
        }

        // ✅ Charger l'article depuis Firestore (dernier article ajouté)
        function loadContent() {
            db.collection("Articles").orderBy("createdAt", "desc").limit(1).get()
            .then((querySnapshot) => {
                querySnapshot.forEach((doc) => {
                    document.getElementById("title").value = doc.data().title;
                    document.getElementById("author").value = doc.data().author;
                    $('#editor').summernote('code', doc.data().content);
                });
            })
            .catch((error) => { 
                console.error("❌ Erreur de chargement:", error);
                alert("❌ Erreur: " + error.message);
            });
        }
    </script>

</body>
</html>
